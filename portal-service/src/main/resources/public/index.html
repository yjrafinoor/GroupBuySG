<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf/.org">
<head>
    <section id="import">
		<div th:replace="fragments/import :: import"></div>
	</section>
    <!--Bootstrap-->
    <!--<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">-->
    <link rel="stylesheet" href="webjars/bootstrap/4.3.1/css/bootstrap.css">
    
    <!--CSS-->
    <link rel="stylesheet" href="css/style.css"/> 

    <!--Bootstrap v5.1-->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js" integrity="sha384-W8fXfP3gkOKtndU4JGtKDvXbO53Wy8SZCQHczT5FMiiqmQfUpWbYdTil/SxwZgAN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js" integrity="sha384-skAcpIdS7UcVUC05LJ9Dxay8AXcDYfBJqt1CJ85S/CFujBsIzCIv+l9liuYLaMQ/" crossorigin="anonymous"></script>
    -->
	<script type="text/javascript" src="/webjars/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript" src="/webjars/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
	<script src="https://apis.google.com/js/platform.js" async defer></script>
    <script>
    	var global_gmail = "";
    	var signupForm = "";

		function onPageInit(){
		    signupForm = document.getElementById('signup-form');
			// Add a listener to the submit event
			//signupForm.addEventListener('submit', function (e) {

				//if(document.getElementById("signup-input-email").value===""){
					//e.preventDefault();
					//alert("Please sign in to google first");
				//}
				//return;
			//});

			refreshUI();
		}

		function signUp_click(){
			//console.log ( document.getElementById("signup-form").elements );
			var elements = document.querySelectorAll("#signup-form input[type=text]") ;
			//console.log(elements);
			for (var i = 0, element; element = elements[i++];) {
				console.log(element.name + ":" + element.value);
			}

			if(!gapi.auth2.getAuthInstance().isSignedIn.get()){
				alert("Sign Up : Please sign in to google first");
				return;
			}
			for (var i = 0, element; element = elements[i++];) {
				if (element.value === "") {
					alert(element.name + " can't be empty.");
					return;
				}
			}
			document.getElementById("signup-form").submit();
		}

    	function refreshUI(){
    		console.log("refreshing UI");
			document.getElementById("signup-button").style.visibility = (gapi.auth2.getAuthInstance().isSignedIn.get()) ?  "hidden" : "visible";
			document.getElementById("signin-button").style.visibility = (gapi.auth2.getAuthInstance().isSignedIn.get()) ? "hidden": "visible";
			document.getElementById("signout-button").style.visibility = !(gapi.auth2.getAuthInstance().isSignedIn.get()) ? "hidden": "visible";
			//document.getElementById("signin-button").style.visibility = "hidden";
		}


		function onSignIn(googleUser) {
		  var profile = googleUser.getBasicProfile();
		  //console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
		  //console.log('Name: ' + profile.getName());
		  //console.log('Image URL: ' + profile.getImageUrl());
		  console.log('Google Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
		  global_gmail = profile.getEmail();
		  document.getElementById("signup-input-email").value = profile.getEmail();
		  document.getElementById("exampleDropdownFormEmail1").value = profile.getEmail();
		  refreshUI();
		}
		function signOut() {
			var auth2 = gapi.auth2.getAuthInstance();
			auth2.signOut().then(function () {
			  document.getElementById("signup-input-email").value = "";
			  document.getElementById("exampleDropdownFormEmail1").value = "Not logged in"
			  console.log('User signed out.');
			  refreshUI();
			});
		}

		window.onload = onPageInit;
	</script>
	<meta charset="UTF-8">
	<meta name="google-signin-client_id" content="1023424773429-jbj94r3d43tkhs1cdsbs6qdjf8nvf4ts.apps.googleusercontent.com">
    <title>Group Buy</title>
</head>
<body>
	<section id="navigation">
		<div th:replace="fragments/navigation :: navbar"></div>
	</section>
    <section id="intro">
        <div class="jumbotron">
          <div class="container">
			<div class="row">
			  <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12">
                <div class="row">
                    <div class="col-ml-12">
                        <h1>Hello Page 1</h1>
                        <p class="lead">Welcome to GroupBuy SG</p>
                        <a class='btn' href="#">aaa</a>
                    </div>
                </div>
			  </div>
			  <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
				<form class="px-4 py-3">
					<div class="form-group">
					  <label for="exampleDropdownFormEmail1">Email address</label>
					  <input type="email" class="form-control" id="exampleDropdownFormEmail1" placeholder="email@example.com">
					</div>
					<div class="form-group" style="display:none;">
					  <label for="exampleDropdownFormPassword1">Password</label>
					  <input type="password" class="form-control" id="exampleDropdownFormPassword1" placeholder="Password">
					</div>
					<div class="form-group" style="display:none;">
					  <div class="form-check">
					    <input type="checkbox" class="form-check-input" id="dropdownCheck">
					    <label class="form-check-label" for="dropdownCheck">Remember me</label>
					  </div>
					</div>
					<!--<div class="row">
						<div class="col d-flex justify-content-end">

						</div>
					</div>-->
				  </form>
				  <div class="col d-flex justify-content-end">
					  <button id="signup-button" class="btn btn-success btn-block col-md-4" type="button" data-toggle="modal" data-target="#user-form-modal">Sign up</button>
					  <button id="signin-button" type="button" data-toggle="modal" data-target="#user-form-modal2" class="btn btn-primary">Already a User?</button>
					  <button id="signout-button"  class="btn btn-primary" onClick="signOut()">Sign Out</button>
				  </div>
				<div class="dropdown-divider"></div>
				<a class="dropdown-item" href="#">Forgot password?</a>
			  </div>
            </div>
		  </div>
        </div>
	</section>
	<section id="logInViaGoogle">
		<div class="modal fade" role="dialog" tabindex="-1" id="user-form-modal2">
			<div class="modal-dialog modal-lg" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Log in</h5>
						<button type="button" class="close" data-dismiss="modal">
							<span aria-hidden="true">x</span>
						</button>
					</div>
					<div class="modal-body">
						<div class="py-1">
							<form action="#" th:action="@{/logInViaGoogle}" method="post" id="login-form">
								<div class="row">
									<div class="col">
										<div class="g-signin2" data-onsuccess="onSignIn"></div>
									</div>
								</div>
								<div class="col d-flex justify-content-end">
									<button id="confirmSignIn-button" type="submit" class="btn btn-primary">Confirm</button>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<section id="signup">
	  <!-- User Form Modal -->
	  <div class="modal fade" role="dialog" tabindex="-1" id="user-form-modal">
	    <div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Sign up</h5>
				<button type="button" class="close" data-dismiss="modal">
				<span aria-hidden="true">x</span>
				</button>
			</div>
			<div class="modal-body">
				<div class="py-1">
				<form action="#" th:action="@{/saveUser}" method="post" id="signup-form">
					<div class="row">
						<div class="col">
							<div class="g-signin2" data-onsuccess="onSignIn"></div>
						</div>
					</div>
					<input id = "signup-input-email" class="form-control" type="text" name="email" value="" style="display:none;" />
					<div class="row">
						<div class="col">
							<div class="row">
								<div class="col">
									<div class="form-group">
										<label>User Name</label>
										<input class="form-control" type="text" name="userName" th:maxlength="50" placeholder="johnny.s" required>
									</div>
								</div>
								<div class="col">
									<div class="form-group">
										<label>Full Name</label>
										<input class="form-control" type="text" name="fullName" th:maxlength="50" placeholder="John Smith" required>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- Jchong removing this section , deprecrate for google sign in
					<div class="row">
						<div class="col">
							<div class="row">
								<div class="col">
									<div class="form-group">
										<label>Email</label>
										<input class="form-control" type="text" name="email" th:maxlength="100" placeholder="user@example.com" required>
									</div>
								</div>
							<div class="col">
								<div class="form-group">
									<label>Password</label>
									<input class="form-control" type="password" name="password" id="password" required>
								</div>
							</div>
							</div>
						</div>
					</div> -->
					<div class="row">
						<div class="col">
							<div class="row">
								<div class="col">
									<div class="form-group">
										<label>Address</label>
										<input class="form-control" type="text" name="address">
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col">
							<div class="row">
								<div class="col">
									<div class="form-group">
										<label>MRT Location</label>
										<select name="mrt" class="form-control" required>
											<option value="" selected>Choose...</option>
											<option value="East West Line">East West Line</option>
											<option value="North South Line">North South Line</option>
											<option value="Circle Line">Circle Line</option>
											<option value="Bukit Panjang LRT">Bukit Panjang LRT</option>
											<option value="North East Line">North East Line</option>
											<option value="Downtown Line">Downtown Line</option>
											<option value="Punggol LRT">Punggol LRT</option>
											<option value="Sengkang LRT">Sengkang LRT</option>
										</select>
									</div>
								</div>
								<div class="col">
									<div class="form-group">
										<label>Contact</label>
										<input class="form-control" type="text" th:maxlength="8" name="contact" required>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col">
							<div class="row">
								<div class="col">
									<div class="form-group">
										<label>Pay Now Name</label>
										<input class="form-control" type="text" th:maxlength="50" name="paynowName" required>
									</div>
								</div>
								<div class="col">
									<div class="form-group">
										<label>Pay Now Number</label>
										<input class="form-control" type="text" th:maxlength="8" name="paynowMobile" required>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col d-flex justify-content-end">
							<button class="btn btn-primary" type="button"  onClick="signUp_click()" >Sign Up</button>
						</div>
					</div>
				</form>
				</div>
			</div>
			</div>
		</div>
	  </div>
	</section>
	<section id="footer">
	<!--  <div th:replace="fragments/footer :: ${#authentication.principal.isAdmin()} ? 'footer-admin' : 'footer'">
	 --> 
		<div th:replace="fragments/footer :: 'footer'"></div>
	</section>
</body>
</html>